# Руководство по движку Hoofd TUIQ

## Обзор
Hoofd TUIQ - это текстовый игровой движок, построенный на Python и Textual, который позволяет создавать интерактивные повествовательные игры с выбором, системой инвентаря и поддержкой нескольких языков.

## Возможности
- Текстовый повествовательный геймплей
- Прогресс на основе выбора
- Система инвентаря
- Функционал сохранения/загрузки
- Поддержка нескольких языков
- Поддержка отображения изображений (конвертируемых в ASCII-арт)
- Условия сцен и отслеживание состояния
- Динамическое изменение текста и изображений на основе состояния игры

## Структура проекта
```
project/
├── assets/           # Изображения и другие медиа-файлы
├── qtui/
│   ├── scenes/      # Определения сцен для разных языков
│   │   ├── __init__.py
│   │   ├── scenes_en.py
│   │   └── scenes_ru.py
│   ├── classes.py   # Основные классы
│   ├── config.toml  # Конфигурационный файл
│   └── main.py      # Основной игровой движок
```

## Конфигурация (config.toml)
```toml
name = "Название игры"       # Заголовок игры
color = "green"             # Цвет текста
background = "black"        # Цвет фона
utilise_inventory = true    # Включить систему инвентаря
utilise_saveload = true     # Включить функционал сохранения/загрузки
language = "en"             # Язык по умолчанию
credits = "Текст титров"    # Текст титров
```

## Создание сцен
Сцены определяются в файлах `scenes_[язык].py`. Пример:

```python
from classes import Scene

example_scene = Scene(
    id_='example_scene',        # Уникальный идентификатор сцены (совпадает с именем переменной)
    header='Заголовок сцены',   # Заголовок сцены
    text='Описание сцены',      # Основной текст
    image='image.jpg',         # Файл изображения из папки assets
    speaker='Имя персонажа',    # Имя говорящего персонажа
    exits=[                     # Доступные варианты выбора
        ('Текст выбора', ('следующая_сцена', 'условие')),
    ],
    on_enter=[                 # Действия при входе в сцену
        (('inventory', 'add', 'Предмет'), 'условие'),
    ],
    if_texts=[                 # Условные изменения текста
        ('Альтернативный текст', 'условие'),
    ],
    if_images=[               # Условные изменения изображения
        ('alt_image.jpg', 'условие'),
    ],
    if_speakers=[             # Условные изменения говорящего
        ('Альт. говорящий', 'условие'),
    ]
)
```

## Действия и условия

### Доступные действия
```python
# Действия с инвентарем
(('inventory', 'add', 'Предмет'), 'условие')
(('inventory', 'add-many', ('Предмет', 5)), 'условие')
(('inventory', 'remove', 'Предмет'), 'условие')
(('inventory', 'remove-all', 'Предмет'), 'условие')
(('inventory', 'clear', ''), 'условие')

# Действия с модификаторами
(('inventory', 'add', 'мод'), 'условие')
(('inventory', 'add-many', ('мод', 5)), 'условие')
(('inventory', 'remove', 'мод'), 'условие')
(('inventory', 'remove-all', 'мод'), 'условие')
(('inventory', 'clear', ''), 'условие')

# Действия с переменными
(('variables', 'add', ('перем', значение)), 'условие')
(('variables', 'remove', 'перем'), 'условие')
(('variables', 'update', ('перем', значение)), 'условие')
(('variables', 'inc', ('перем', количество)), 'условие')
(('variables', 'dec', ('перем', количество)), 'условие')

# Игровые действия
(('game', 'exit', ''), 'условие')
(('game', 'goto', 'id_сцены'), 'условие')
(('game', 'restart', ''), 'условие')
(('game', 'notify', 'сообщение'), 'условие')
```

### Контекстные переменные в условиях
В условиях доступны:
- `player`: Объект игрока
- `inventory`: Список предметов инвентаря
- `invdict`: Словарь предметов инвентаря и их количества
- `mods`: Список модификаторов
- `modsdict`: Словарь модификаторов и их количества
- `vars`: Словарь переменных
- `random`: Модуль random
- `rnum`: Случайное число (0-100)

## Пример реализации игры

```python
# scenes_ru.py
from classes import Scene

start = Scene(
    id_='start',
    header='Лес',
    text='Вы находитесь в темном лесу.',
    image='forest.jpg',
    exits=[
        ('Идти на север', ('north', 'True')),
    ],
    on_enter=[
        (('inventory', 'add', 'Карта'), '"Карта" not in inventory'),
    ]
)

# Добавьте больше сцен...

# Обязательные константы для интерфейса
START = 'Начать'
LOAD = 'Загрузить'
SAVE = 'Сохранить'
CREDITS = 'Титры'
EXIT = 'Выход'
LANGUAGE = 'Язык'
