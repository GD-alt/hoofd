# Руководство по движку Hoofd TUIQ

## Обзор
Hoofd TUIQ - это текстовый игровой движок, построенный на Python и Textual, который позволяет создавать интерактивные повествовательные игры с выбором, системой инвентаря и поддержкой нескольких языков.

## Возможности
- Текстовый повествовательный геймплей
- Прогресс на основе выбора
- Система инвентаря
- Функционал сохранения/загрузки
- Поддержка нескольких языков
- Поддержка отображения изображений (конвертируемых в ASCII-арт)
- Условия сцен и отслеживание состояния
- Динамическое изменение текста и изображений на основе состояния игры
- Система модификаторов
- Система переменных
- Система говорящих с условными изменениями
- Опции форматирования и санитизации текста

## Структура проекта
```
project/
├── assets/           # Изображения и другие медиа-файлы
├── qtui/
│   ├── scenes/      # Определения сцен для разных языков
│   │   ├── __init__.py
│   │   └── scenes_[lang].py
│   ├── classes.py   # Основные классы
│   ├── config.toml  # Конфигурационный файл
│   └── main.py      # Основной игровой движок
```

## Конфигурация (config.toml)
```toml
name = "Название игры"       # Заголовок игры
color = "green"             # Цвет текста
background = "black"        # Цвет фона
utilise_inventory = true    # Включить систему инвентаря
utilise_saveload = true    # Включить функционал сохранения/загрузки
language = "en"            # Язык по умолчанию
languages = ["en"]         # Доступные языки
credits = "Текст титров"   # Текст титров
```

## Определение сцены
Сцены определяются в файлах `scenes_[язык].py` используя класс Scene:

```python
from classes import Scene

example_scene = Scene(
    id_='example_scene',        # Уникальный идентификатор сцены (совпадает с названием переменной)
    header='Заголовок сцены',   # Заголовок сцены
    text='Описание сцены',      # Основной текст
    image='image.jpg',          # Файл изображения из папки assets (опционально)
    speaker='Имя персонажа',    # Имя говорящего персонажа (опционально)
    exits=[                     # Доступные варианты выбора
        ('Текст выбора', ('следующая_сцена', 'условие')),
    ],
    on_enter=[                  # Действия при входе в сцену
        (('тип_действия', 'действие', 'значение'), 'условие'),
    ],
    if_texts=[                  # Условные изменения текста
        ('Альтернативный текст', 'условие'),
    ],
    if_text_additions=[         # Условные добавления текста
        ('Дополнительный текст', 'условие'),
    ],
    if_images=[                 # Условные изменения изображения
        ('alt_image.jpg', 'условие'),
    ],
    if_speakers=[               # Условные изменения говорящего
        ('Альт. говорящий', 'условие'),
    ],
    enable_formatting=True,      # Включить форматирование переменных в тексте
    sanitize=False              # Включить санитизацию текста
)
```

## Система действий

### Типы действий
1. Действия с инвентарём
```python
(('inventory', 'add', 'Предмет'), 'условие')
(('inventory', 'add-many', ('Предмет', количество)), 'условие')
(('inventory', 'remove', 'Предмет'), 'условие')
(('inventory', 'remove-all', 'Предмет'), 'условие')
(('inventory', 'clear', ''), 'условие')
```

2. Действия с модификаторами
```python
(('modifiers', 'add', 'мод'), 'условие')
(('modifiers', 'add-many', ('мод', количество)), 'условие')
(('modifiers', 'remove', 'мод'), 'условие')
(('modifiers', 'remove-all', 'мод'), 'условие')
(('modifiers', 'clear', ''), 'условие')
```

3. Действия с переменными
```python
(('variables', 'add', ('перем', значение)), 'условие')
(('variables', 'remove', 'перем'), 'условие')
(('variables', 'update', ('перем', значение)), 'условие')
(('variables', 'inc', ('перем', количество)), 'условие')
(('variables', 'dec', ('перем', количество)), 'условие')
(('variables', 'set', ('перем', 'выражение')), 'условие')
```

4. Игровые действия
```python
(('game', 'exit', ''), 'условие')
(('game', 'goto', 'id_сцены'), 'условие')
(('game', 'restart', ''), 'условие')
(('game', 'notify', 'сообщение'), 'условие')
(('game', 'destroy', ''), 'условие')
(('game', 'load', 'silent'), 'условие')
(('game', 'save', 'silent'), 'условие')
```

## Контекст условий
В условиях доступны:
- `player`: Объект игрока
- `inventory`: Список предметов инвентаря
- `invdict`: Словарь предметов инвентаря и их количества
- `mods`: Список модификаторов
- `modsdict`: Словарь модификаторов и их количества
- `vars`: Словарь переменных
- `random`: Модуль random
- `rnum`: Случайное число (0-100)
- `SYS`: Системные сцены
- `MY`: Пользовательские переменные

## Обязательные языковые константы
Каждый языковой файл должен определять:
```python
START = 'Начать'
LOAD = 'Загрузить'
SAVE = 'Сохранить'
LOAD_SHORT = 'З'
SAVE_SHORT = 'С'
CREDITS = 'Титры'
EXIT = 'Выход'
LANGUAGE = 'Язык'
SAVED = 'Сохранено'
LOADED = 'Загружено'
RESTART_NEEDED = 'Требуется перезапуск'
```

## Глобальные модификации сцен
Определите эти списки в языковых файлах:
```python
GLOBAL_ADDITIONS = []  # Глобальные добавления текста
GLOBAL_IMAGES = []     # Глобальные изменения изображений
VARS = {}             # Глобальные переменные
MY_VARS = {}          # Пользовательские переменные
```
